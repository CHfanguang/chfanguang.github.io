<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Shadow Moon · 官网</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei";
  background:linear-gradient(135deg,#cfcfcf,#f6f6f6 30%,#bdbdbd 60%,#f0f0f0);
  color:#000;
  -webkit-overflow-scrolling: touch; /* 滚动优化 */
}

/* 吸顶 LOGO 完全不动 */
.top-logo{
  position:sticky;
  top:14px;
  z-index:999;
  margin:14px auto 30px;
  width:fit-content;
  padding:14px 28px;
  background:rgba(255,255,255,.45);
  backdrop-filter:blur(30px) saturate(220%);
  -webkit-backdrop-filter:blur(30px) saturate(220%);
  border-radius:30px;
  box-shadow:inset 0 1px 1px rgba(255,255,255,.7), 0 18px 40px rgba(0,0,0,.18);
}
.logo{
  font-size:30px;
  font-weight:900;
  letter-spacing:.6px;
}
.logo span {
  text-shadow: none;
}

/* 内容动画 */
.container{
  max-width:900px;
  margin:auto;
  padding:20px 20px 140px;
  animation:iosIn .9s ease-out both;
}
@keyframes iosIn{
  from{opacity:0;transform:translateY(70px)}
  to{opacity:1;transform:translateY(0)}
}

/* iOS 液态玻璃 */
.glass{
  background:rgba(255,255,255,.45);
  backdrop-filter:blur(30px) saturate(220%);
  -webkit-backdrop-filter:blur(30px) saturate(220%);
  border-radius:28px;
  padding:30px;
  line-height:1.7;
  box-shadow:inset 0 1px 1px rgba(255,255,255,.7), 0 30px 50px rgba(0,0,0,.18);
  position: relative;
  overflow: hidden;
}

/* 科技线条装饰 */
.tech-line {
  height: 1px;
  background: linear-gradient(90deg, transparent, #00ffff, transparent);
  margin: 22px 0;
  opacity: 0.6;
}
.tech-dot {
  color: #00ffff;
  font-weight: bold;
}

.title{
  font-size:26px;
  font-weight:900;
  margin-bottom:10px;
}
.footer{
  text-align:center;
  margin:80px 0 160px;
  color:#888;
  font-size:14px;
  line-height:1.6;
}

/* 底部导航 完全不动 */
.bottom-nav{
  position:fixed;
  bottom:26px;
  left:50%;
  transform:translateX(-50%);
  width:82%;
  max-width:420px;
  background:rgba(255,255,255,.45);
  backdrop-filter:blur(30px) saturate(220%);
  -webkit-backdrop-filter:blur(30px) saturate(220%);
  border-radius:30px;
  display:flex;
  justify-content:space-evenly;
  padding:16px 0;
  z-index:1000;
}
.bottom-nav a{
  text-decoration:none;
  font-weight:700;
  color:#000;
  padding: 0 8px;
}

/* 像素字体 */
.pixel-header {
  text-align: center;
  margin-bottom:30px;
  width:100%;
}
.pixel-line {
  display: block;
  font-family: 'Press Start 2P', monospace;
  font-weight:400;
  line-height:1.5;
  letter-spacing:2px;
  text-shadow: 0 0 8px currentColor, 0 0 20px currentColor, 0 0 35px currentColor;
}
.pixel-shadow {
  color: rgba(155,77,255,0.9);
  font-size:40px;
  margin-bottom:8px;
}
.pixel-ch {
  color: rgba(61,126,255,0.9);
  font-size:38px;
}
@media (max-width: 550px) {
  .pixel-shadow { font-size:30px; }
  .pixel-ch { font-size:28px; }
}

/* 彩色发光 */
.title span:not([style*="color:#000"]) {
  text-shadow: 0 0 5px currentColor,0 0 15px currentColor;
  transition: text-shadow 0.2s ease;
}
.title span[style*="color:#000"] {
  text-shadow: none;
}

.qq-tip {
  color: #888;
  font-style: italic;
  font-size:14px;
}

/* 音乐按钮 */
.music-btn {
  display: block;
  margin: 22px auto;
  padding: 12px 30px;
  background:rgba(61,126,255,0.2);
  border: 2px solid #3d7eff;
  border-radius: 18px;
  color:#000;
  font-size:16px;
  font-weight:bold;
  cursor: pointer;
  text-align: center;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  width: fit-content;
  min-width: 180px;
  -webkit-tap-highlight-color: transparent;
}
.music-btn:hover {
  background:rgba(61,126,255,0.35);
  transform: translateY(-2px);
}
.music-btn.playing {
  background:rgba(0,255,0,0.15);
  border-color: #00ffaa;
  box-shadow: 0 0 15px rgba(0,255,0,0.3);
}
</style>
</head>
<body>

<!-- 
   终极稳定方案：采用 “永久循环 + 心跳保持 + 双重AudioContext + 空播放占位” 
   确保哪怕页面完全静止，音乐也绝不中断。
-->
<audio id="bg-music" preload="auto" loop playsinline style="display:none;" src="petal_20260227_112134.mp4"></audio>
<audio id="heartbeat-audio" preload="auto" loop playsinline style="display:none;"></audio> <!-- 心跳保持器 -->

<!-- 吸顶栏 -->
<div class="top-logo">
  <span class="logo">
    <span style="color:#4285F4;">S</span><span style="color:#EA4335;">h</span><span style="color:#FBBC05;">a</span><span style="color:#4285F4;">d</span><span style="color:#34A853;">o</span><span style="color:#EA4335;">w</span><span style="color:#000;"> </span><span style="color:#34A853;">M</span><span style="color:#4285F4;">o</span><span style="color:#EA4335;">o</span><span style="color:#FBBC05;">n</span>
  </span>
</div>

<div class="container">
  <div class="glass">
    <div class="pixel-header">
      <span class="pixel-line pixel-shadow">Shadow Moon</span>
      <span class="pixel-line pixel-ch">CH凡光</span>
    </div>
    <div class="title">
      <span style="color:#4285F4;">欢</span><span style="color:#EA4335;">迎</span><span style="color:#FBBC05;">进</span><span style="color:#4285F4;">入</span><span style="color:#34A853;"> </span><span style="color:#EA4335;">Shadow Moon</span><span style="color:#000;"> 官方网站</span>
    </div>
    <div class="tech-line"></div>
    <p><span class="tech-dot">•</span> 服务项目：<br>我的世界外挂 / VPN翻墙 / 华为装谷歌 / 帮助制作官网 / 网页美化 / 短信代轰炸无限时长 / 技术指导 / 开全家户籍 / 户籍出道 / 手机号轰炸无限循环 / tg飞机账号购买 / 翻墙避免被抓教程 / 翻墙必备软件 / 公安天眼查户籍 / 猎魔查户籍 / 查名下房产 / 查家庭住址 /所有商品均为1元</p>
    <button class="music-btn" id="musicToggleBtn">播放本站音乐</button>
    <p><span class="tech-dot">•</span> 咨询通道：<br><a href="https://qm.qq.com/q/JYP3V4yogK" target="_blank">QQ好友</a></p><div class="qq-tip">未能跳转请手动添加QQ好友：3683029258</div>
    <p><span class="tech-dot">•</span> 备用通道：<a href="https://qm.qq.com/q/Gq3tfhiXG8" target="_blank">备用QQ好友</a></p><div class="qq-tip">未能跳转请手动添加QQ好友：3581370395</div>
    <div class="tech-line"></div>
    <p><span class="tech-dot">•</span> 客服时间：08:00–22:00（回复≤30分钟）</p>
    <p><span class="tech-dot">•</span> 所有商品：1 元</p>
    <p><span class="tech-dot">•</span> 支付方式：微信支付</p>
    <p><span class="tech-dot">•</span> 售后服务：终身免费</p>
    <div class="tech-line"></div>
    <p><span class="tech-dot">•</span> 官方QQ群：523725674</p>
    <p><span class="tech-dot">•</span> 快手账号：<a href="https://v.kuaishou.com/JE2u8ANT" target="_blank">快手账号</a>（我的世界CH凡光）</p>
    <div class="tech-line"></div>
    <p><b>免责声明</b><br>本站内容仅供学习与技术交流。<br>使用相关软件产生的后果由使用者自行承担。<br>请遵守法律法规，合法使用。<br>本网站/软件售卖出的商品改不退还，请慎重考虑。<br>本网站所有商品均为1元/不讲价/不赊账</p>
    <div class="footer">Powerd by Shadow Moon<br>© CH凡光</div>
  </div>
</div>

<!-- 底部导航 -->
<div class="bottom-nav">
  <a href="index.html">主页</a>
  <a href="notice.html">通知</a>
  <a href="other.html">其他</a>
</div>

<script>
(function() {
  // --------------------------------------------------------------
  // 超强稳定音乐引擎 · 双内核 + 心跳维持 + 无感自愈
  // --------------------------------------------------------------
  const audioElem = document.getElementById('bg-music');
  const heartbeatElem = document.getElementById('heartbeat-audio'); // 用于维持音频激活状态
  const btn = document.getElementById('musicToggleBtn');

  // 配置
  const AUDIO_URL = "petal_20260227_112134.mp4";
  if (!audioElem.src || audioElem.src === window.location.href) {
    audioElem.src = AUDIO_URL;
  }

  // 核心状态
  let isPlaying = false;              // 用户期望的播放状态
  let userDisabled = false;           // 用户是否主动暂停
  let useWorklet = false;             // 是否采用AudioWorklet (true则接管一切)
  let audioContext = null;
  let workletSource = null;           // 音频节点源 (MediaElementSource)
  let gainNode = null;
  let workletInitialized = false;
  let fallbackMode = false;           // 若worklet不可用，则用增强回退
  
  // 心跳定时器 (用于强制唤醒)
  let keepAliveInterval = null;
  
  // ---- UI 更新 ----
  function setUIPlaying(playing) {
    if (playing) {
      btn.classList.add('playing');
      btn.textContent = '暂停本站音乐';
    } else {
      btn.classList.remove('playing');
      btn.textContent = '播放本站音乐';
    }
  }

  // ---- 清理旧的worklet资源 ----
  function cleanupWorklet() {
    if (workletSource) {
      try { workletSource.disconnect(); } catch (e) {}
      workletSource = null;
    }
    // 注意: 不关闭audioContext，可能复用
  }

  // ---- 初始化 AudioContext + Worklet (核心) ----
  async function initWorklet() {
    if (workletInitialized) return true;
    if (!window.AudioContext && !window.webkitAudioContext) {
      console.warn('Web Audio 不支持，回退模式');
      fallbackMode = true;
      return false;
    }
    
    try {
      const AudioCtor = window.AudioContext || window.webkitAudioContext;
      // 创建上下文，延迟小一点
      audioContext = new AudioCtor({ latencyHint: 'playback' });
      
      // 创建增益节点
      gainNode = audioContext.createGain();
      gainNode.gain.value = 0.7;
      gainNode.connect(audioContext.destination);
      
      // 从audio元素创建源
      if (audioElem.readyState >= 1) { // HAVE_METADATA
        try {
          workletSource = audioContext.createMediaElementSource(audioElem);
          workletSource.connect(gainNode);
        } catch (e) {
          console.warn('createMediaElementSource 失败，降级回退', e);
          fallbackMode = true;
          return false;
        }
      } else {
        // 等待元数据加载
        await new Promise(resolve => {
          audioElem.addEventListener('loadedmetadata', resolve, { once: true });
          audioElem.load();
        });
        workletSource = audioContext.createMediaElementSource(audioElem);
        workletSource.connect(gainNode);
      }
      
      // 尝试激活audio worklet (静默处理器，维持音频上下文活跃)
      try {
        // 由于 worklet 需要https或localhost，有些环境不支持，这里不阻塞
        await audioContext.audioWorklet.addModule('data:application/javascript;charset=utf-8,' + 
          encodeURIComponent(`
            class KeepAliveProcessor extends AudioWorkletProcessor {
              constructor() { super(); }
              process(inputs, outputs, parameters) {
                return true; // 永远保持活跃
              }
            }
            registerProcessor('keep-alive', KeepAliveProcessor);
          `)
        );
        // 创建worklet节点，无输入输出，只为了保持context状态
        let workletNode = new AudioWorkletNode(audioContext, 'keep-alive');
        workletNode.connect(gainNode); // 虚加载
      } catch (e) {
        // worklet失败不影响主流程
        console.log('worklet 模块加载失败（正常降级）');
      }
      
      workletInitialized = true;
      return true;
    } catch (e) {
      console.error('初始化worklet失败', e);
      fallbackMode = true;
      return false;
    }
  }

  // ---- 启动worklet播放 ----
  async function playWorklet() {
    if (!workletInitialized) {
      const ok = await initWorklet();
      if (!ok) {
        playFallback();
        return;
      }
    }
    
    // 确保context是激活的
    if (audioContext.state === 'suspended') {
      try {
        await audioContext.resume();
      } catch (e) {
        console.warn('context resume失败', e);
        playFallback();
        return;
      }
    }
    
    // 播放audio元素 (实际数据源)
    try {
      await audioElem.play();
      isPlaying = true;
      setUIPlaying(true);
      startKeepAlive();   // 启动心跳维持
    } catch (e) {
      console.warn('worklet play error', e);
      playFallback();
    }
  }

  // ---- worklet暂停 ----
  function pauseWorklet() {
    audioElem.pause();
    // 注意：不关闭context，保留以便快速恢复
    if (audioContext && audioContext.state === 'running') {
      audioContext.suspend().catch(e => {});
    }
    isPlaying = false;
    setUIPlaying(false);
    stopKeepAlive();
  }

  // ---- 回退模式 (增强版) ----
  function playFallback() {
    fallbackMode = true;
    audioElem.play()
      .then(() => {
        isPlaying = true;
        setUIPlaying(true);
        startKeepAlive(); // 心跳同样有效
      })
      .catch(e => {
        console.error('fallback播放失败', e);
        alert('提示：音乐无法播放，但不影响页面浏览。');
        isPlaying = false;
        setUIPlaying(false);
      });
  }

  function pauseFallback() {
    audioElem.pause();
    isPlaying = false;
    setUIPlaying(false);
    stopKeepAlive();
  }

  // ---- 心跳机制：每秒检查一次，确保播放永不停止 ----
  function startKeepAlive() {
    if (keepAliveInterval) clearInterval(keepAliveInterval);
    keepAliveInterval = setInterval(() => {
      // 如果用户期望播放但audio暂停了
      if (isPlaying && audioElem.paused) {
        console.warn('检测到意外暂停，尝试恢复');
        // 尝试多种恢复
        if (!fallbackMode && audioContext && audioContext.state === 'suspended') {
          audioContext.resume().catch(e => {});
        }
        audioElem.play().catch(e => {});
      }
      
      // 额外：如果是worklet模式，检查context状态
      if (!fallbackMode && audioContext && isPlaying) {
        if (audioContext.state === 'suspended') {
          audioContext.resume().catch(e => {});
        }
      }
      
      // 创造一个极小音量空白音频强制刷新音频激活状态 (针对某些移动浏览器)
      const silentAudio = new Audio();
      silentAudio.volume = 0.01; // 极低音量
      silentAudio.src = 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVgAAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f38=';
      silentAudio.play().catch(e => {}).then(() => {
        setTimeout(() => { silentAudio.pause(); silentAudio.src = ''; }, 50);
      });
    }, 800); // 0.8秒检查一次，非常激进
  }

  function stopKeepAlive() {
    if (keepAliveInterval) {
      clearInterval(keepAliveInterval);
      keepAliveInterval = null;
    }
  }

  // ---- 统一开关 ----
  function toggleMusic() {
    if (isPlaying) {
      // 用户主动暂停
      if (fallbackMode) {
        pauseFallback();
      } else {
        pauseWorklet();
      }
    } else {
      // 尝试用worklet播放
      if (fallbackMode) {
        playFallback();
      } else {
        playWorklet().catch(e => {
          console.error('worklet播放失败', e);
          // 降级重试
          fallbackMode = true;
          playFallback();
        });
      }
    }
  }

  // ---- 超级稳定性监听 ----
  // 1. 页面可见性切换
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden && isPlaying && audioElem.paused) {
      // 恢复播放
      if (fallbackMode) {
        audioElem.play().catch(e => {});
      } else {
        if (audioContext && audioContext.state === 'suspended') {
          audioContext.resume().catch(e => {});
        }
        audioElem.play().catch(e => {});
      }
    }
  });

  // 2. 触摸/滚动保持 (极轻量恢复)
  let scrollTimer;
  window.addEventListener('scroll', () => {
    if (isPlaying && audioElem.paused) {
      if (scrollTimer) clearTimeout(scrollTimer);
      scrollTimer = setTimeout(() => {
        if (isPlaying && audioElem.paused) {
          audioElem.play().catch(e => {});
        }
      }, 100);
    }
  });

  // 3. 预加载 & 启动初始化
  audioElem.load();
  
  // 预创建heartbeat元素但不使用，仅用于占位
  heartbeatElem.src = 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVgAAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f38=';
  heartbeatElem.volume = 0;

  // 4. 音频错误恢复
  audioElem.addEventListener('error', (e) => {
    console.warn('audio错误', e);
    if (isPlaying) {
      // 尝试重新设置src
      audioElem.src = AUDIO_URL;
      audioElem.load();
      setTimeout(() => {
        if (isPlaying) audioElem.play().catch(e => {});
      }, 100);
    }
  });

  // 5. 拦截浏览器的音频自动暂停策略 (通过空音频占位)
  function antiFreeze() {
    // 对于某些WebView，不断创建短暂音频保持音频激活
    if (isPlaying) {
      const anti = new Audio();
      anti.src = 'data:audio/wav;base64,UklGRlwAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVgAAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f38=';
      anti.volume = 0;
      anti.play().catch(e => {}).then(() => {
        setTimeout(() => { anti.pause(); anti.src = ''; }, 50);
      });
    }
    requestAnimationFrame(antiFreeze);
  }
  // 可选启用，但可能会消耗性能，暂不启用。用keepAlive代替

  // 绑定按钮
  btn.addEventListener('click', toggleMusic);
  
  // 初始文字
  setUIPlaying(false);
  
  // 预初始化worklet (不播放，但提前加载，以便点击后快速响应)
  window.setTimeout(() => {
    if (!fallbackMode && !workletInitialized) {
      initWorklet().catch(e => {});
    }
  }, 500);
  
})();
</script>
</body>
</html>